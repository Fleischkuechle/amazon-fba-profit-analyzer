<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="title_app">eBay Profit Analyzer</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind for custom theme -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'ebay-dark': '#1e293b',
                        'ebay-medium': '#334155',
                        'ebay-light': '#475569',
                        'profit-green': '#10b981',
                        'loss-red': '#ef4444',
                        'accent-blue': '#38bdf8',
                        'ebay-primary': '#a3a3a3',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        /* General styling adjustments for better UX */
        input[type="number"],
        select {
            background-color: #334155;
            color: white;
            border: 1px solid #475569;
        }

        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #38bdf8;
            box-shadow: 0 0 0 1px #38bdf8;
        }

        /* Hide number input arrows */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type=number] {
            -moz-appearance: textfield;
        }

        /* Styling for the new label indicators */
        .label-indicator {
            font-weight: normal;
            margin-top: 4px;
            font-size: 0.75rem;
            line-height: 1rem;
            color: #94a3b8;
        }

        /* Styling for the details summary button */
        details summary {
            cursor: pointer;
            padding: 0.5rem 0;
            outline: none;
            list-style: none;
            font-weight: 600;
        }

        details summary::-webkit-details-marker {
            display: none;
        }

        details summary::after {
            content: '▼';
            float: right;
            transition: transform 0.2s;
            font-size: 0.8rem;
            color: #94a3b8;
        }

        details[open] summary::after {
            content: '▲';
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body class="bg-ebay-dark min-h-screen p-4 font-sans text-white">

    <div class="max-w-2xl mx-auto">
        <header class="text-center mb-6">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-ebay-primary" data-i18n="title_app">eBay Profit Analyzer
            </h1>
            <p class="text-ebay-light mt-1 text-sm sm:text-base" data-i18n="subtitle_app">Calculate your eBay
                profitability and key metrics.</p>
        </header>

        <div class="bg-ebay-medium p-4 sm:p-6 rounded-xl shadow-2xl space-y-6">

            <!-- LANGUAGE SETTING -->
            <div class="flex justify-end mb-4">
                <select id="languageSelector" onchange="setLanguage(this.value)"
                    class="p-2 rounded-lg text-sm bg-ebay-light text-white border border-ebay-light">
                    <option value="en" data-i18n="lang_en">English</option>
                    <option value="de" data-i18n="lang_de">German</option>
                </select>
            </div>

            <!-- INPUTS SECTION -->
            <section class="space-y-4">
                <h2 class="text-xl font-bold text-gray-200 border-b border-ebay-light pb-2"
                    data-i18n="h2_primary_inputs">Primary Financial Inputs</h2>

                <!-- Primary Inputs (Always Visible: Price & COGS) -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">

                    <div>
                        <label for="sellingPrice" class="flex flex-col text-sm font-medium text-gray-300">
                            <span data-i18n="label_selling_price">Selling Price ($)</span>
                            <span id="minPriceValue" class="label-indicator"></span>
                        </label>
                        <input type="number" id="sellingPrice" value="25.00" min="0.01" step="0.01"
                            oninput="updateProfit()"
                            class="mt-1 w-full p-2 rounded-lg transition-all focus:ring-1 focus:ring-accent-blue">
                    </div>

                    <div>
                        <label for="cogs" class="flex flex-col text-sm font-medium text-gray-300">
                            <span data-i18n="label_cogs">Cost of Goods Sold (COGS) ($)</span>
                            <span id="maxCogsValueContainer" class="label-indicator"></span>
                        </label>
                        <input type="number" id="cogs" value="5.00" min="0" step="0.01" oninput="updateProfit()"
                            class="mt-1 w-full p-2 rounded-lg transition-all focus:ring-1 focus:ring-accent-blue">
                    </div>
                </div>

                <!-- Collapsible Detail Inputs (Fees, Volume, and Target Profit) -->
                <details class="rounded-xl bg-ebay-light p-4 shadow-inner mt-6">
                    <summary class="text-gray-200 hover:text-accent-blue transition-colors" data-i18n="summary_details">
                        Detailed Fees, Shipping, & Target</summary>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 pt-4 border-t border-ebay-medium mt-2">

                        <!-- TARGET PROFIT -->
                        <div>
                            <label for="targetProfit" class="block text-sm font-medium text-gray-300"
                                data-i18n="label_target_profit">
                                Target Net Profit ($)
                            </label>
                            <input type="number" id="targetProfit" value="5.00" min="0" step="0.01"
                                oninput="updateProfit()"
                                class="mt-1 w-full p-2 rounded-lg transition-all focus:ring-1 focus:ring-accent-blue">
                        </div>

                        <div>
                            <label for="ebayFeeRate" class="block text-sm font-medium text-gray-300"
                                data-i18n="label_ebay_fee_rate">
                                Total eBay Fee Rate (FVF + Payment Processing) (%)
                            </label>
                            <input type="number" id="ebayFeeRate" value="13" min="1" max="50" step="0.1"
                                oninput="updateProfit()"
                                class="mt-1 w-full p-2 rounded-lg transition-all focus:ring-1 focus:ring-accent-blue">
                        </div>

                        <!-- Outbound Shipping Cost -->
                        <div>
                            <label for="outboundShippingCost" class="block text-sm font-medium text-gray-300"
                                data-i18n="label_shipping_cost">
                                Outbound Shipping Cost Paid by Seller ($)
                            </label>
                            <input type="number" id="outboundShippingCost" value="5.00" min="0" step="0.01"
                                oninput="updateProfit()"
                                class="mt-1 w-full p-2 rounded-lg transition-all focus:ring-1 focus:ring-accent-blue">
                        </div>

                        <!-- Promoted Listing Rate -->
                        <div>
                            <label for="promotedListingRate" class="block text-sm font-medium text-gray-300"
                                data-i18n="label_promoted_rate">
                                Promoted Listing Rate (Ad Spend) (%)
                            </label>
                            <input type="number" id="promotedListingRate" value="0.00" min="0" max="50" step="0.1"
                                oninput="updateProfit()"
                                class="mt-1 w-full p-2 rounded-lg transition-all focus:ring-1 focus:ring-accent-blue">
                        </div>

                        <!-- Prep Costs -->
                        <div>
                            <label for="prepCosts" class="block text-sm font-medium text-gray-300"
                                data-i18n="label_prep_costs">
                                Prep & Labeling Costs ($)
                            </label>
                            <input type="number" id="prepCosts" value="0.50" min="0" step="0.01"
                                oninput="updateProfit()"
                                class="mt-1 w-full p-2 rounded-lg transition-all focus:ring-1 focus:ring-accent-blue">
                        </div>

                        <!-- Miscellaneous Costs -->
                        <div>
                            <label for="miscellaneousCosts" class="block text-sm font-medium text-gray-300"
                                data-i18n="label_misc_costs">
                                Miscellaneous Per-Unit Costs ($)
                            </label>
                            <input type="number" id="miscellaneousCosts" value="0.00" min="0" step="0.01"
                                oninput="updateProfit()"
                                class="mt-1 w-full p-2 rounded-lg transition-all focus:ring-1 focus:ring-accent-blue">
                        </div>

                        <!-- Units Sold -->
                        <div class="sm:col-span-2">
                            <label for="unitsSold" class="block text-sm font-medium text-gray-300"
                                data-i18n="label_units_sold">
                                Estimated Monthly Units Sold
                            </label>
                            <input type="number" id="unitsSold" value="300" min="1" step="1" oninput="updateProfit()"
                                class="mt-1 w-full p-2 rounded-lg transition-all focus:ring-1 focus:ring-accent-blue">
                        </div>
                    </div>
                </details>

            </section>

            <hr class="border-ebay-light">

            <!-- RESULTS SECTION -->
            <section>
                <h2 class="text-xl font-bold text-gray-200 border-b border-ebay-light pb-2 mb-4" data-i18n="h2_results">
                    Results Overview</h2>

                <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4">

                    <!-- Box 1: Net Profit -->
                    <div class="bg-ebay-light p-3 rounded-lg shadow-lg">
                        <p class="text-xs font-medium text-gray-300" data-i18n="box_net_profit">Net Profit / Unit</p>
                        <p id="netProfit"
                            class="text-xl sm:text-2xl font-bold mt-1 text-center py-1 sm:py-2 rounded-lg transition-colors">
                        </p>
                    </div>

                    <!-- Box 2: Profit Margin -->
                    <div class="bg-ebay-light p-3 rounded-lg shadow-lg">
                        <p class="text-xs font-medium text-gray-300" data-i18n="box_profit_margin">Profit Margin</p>
                        <p id="profitMargin"
                            class="text-xl sm:text-2xl font-bold text-profit-green mt-1 text-center py-1 sm:py-2 rounded-lg">
                        </p>
                    </div>

                    <!-- Box 3: ROI -->
                    <div class="bg-ebay-light p-3 rounded-lg shadow-lg">
                        <p class="text-xs font-medium text-gray-300" data-i18n="box_roi">ROI</p>
                        <p id="roi"
                            class="text-xl sm:text-2xl font-bold text-profit-green mt-1 text-center py-1 sm:py-2 rounded-lg">
                        </p>
                    </div>

                    <!-- Box 4: Monthly Profit -->
                    <div class="bg-ebay-light p-3 rounded-lg shadow-lg">
                        <p class="text-xs font-medium text-gray-300">
                            <span data-i18n="box_monthly_profit_pre">Monthly Profit (Based on</span>
                            <span id="unitsSoldDisplay">300</span>
                            <span data-i18n="box_monthly_profit_post">Units)</span>
                        </p>
                        <p id="monthlyProfit"
                            class="text-xl sm:text-2xl font-bold text-profit-green mt-1 text-center py-1 sm:py-2 rounded-lg">
                        </p>
                    </div>
                </div>
            </section>

            <hr class="border-ebay-light">

            <!-- UNIT COST BREAKDOWN SECTION -->
            <section>
                <h2 class="text-xl font-bold text-gray-200 border-b border-ebay-light pb-2 mb-4"
                    data-i18n="h2_breakdown">Unit Cost Breakdown</h2>
                <div class="grid grid-cols-3 gap-x-4 gap-y-2 text-sm">

                    <div class="flex justify-between items-center text-gray-300 col-span-2">
                        <span data-i18n="breakdown_ebay_fee">Total eBay Fee (FVF + Payment):</span>
                        <span id="displayEbayFee" class="font-semibold text-accent-blue"></span>
                    </div>
                    <div class="flex justify-between items-center text-gray-300 col-span-2">
                        <span data-i18n="breakdown_promoted_fee">Promoted Listing Fee:</span>
                        <span id="displayPromotedFee" class="font-semibold text-accent-blue"></span>
                    </div>
                    <div class="flex justify-between items-center text-gray-300 col-span-2">
                        <span data-i18n="breakdown_shipping_cost">Outbound Shipping Cost:</span>
                        <span id="displayShippingCost" class="font-semibold text-accent-blue"></span>
                    </div>
                    <div class="flex justify-between items-center text-gray-300 col-span-2">
                        <span data-i18n="breakdown_prep_misc">Prep & Other Costs:</span>
                        <span id="displayOtherFixedCostsCombined" class="font-semibold text-accent-blue"></span>
                    </div>

                    <!-- Line Divider -->
                    <div class="col-span-3 border-t border-ebay-medium pt-2 mb-1"></div>

                    <!-- SUMMARY: Total Selling Fees -->
                    <div class="flex justify-between items-center font-bold text-gray-100 col-span-2">
                        <span class="text-sm" data-i18n="breakdown_total_fees">TOTAL SELLING FEES & COSTS:</span>
                        <span id="displayTotalSellingFees" class="text-base text-accent-blue font-extrabold"></span>
                    </div>

                    <!-- COGS Line Item -->
                    <div class="flex justify-between items-center text-gray-100 col-span-2">
                        <span class="text-sm" data-i18n="breakdown_cogs">COST OF GOODS SOLD (COGS):</span>
                        <span id="displayCOGS" class="text-base font-extrabold text-white"></span>
                    </div>

                    <!-- FINAL SUMMARY: Total Investment -->
                    <div
                        class="flex justify-between items-center font-bold text-gray-100 col-span-2 mt-2 pt-2 border-t border-accent-blue">
                        <span class="text-base" data-i18n="breakdown_total_investment">TOTAL INVESTMENT (PRICE
                            FLOOR):</span>
                        <span id="displayTotalInvestment" class="text-lg text-loss-red font-extrabold"></span>
                    </div>
                </div>
            </section>

        </div>
    </div>

    <script>
        // --- TRANSLATION DATA ---
        const translations = {
            en: {
                title_app: "eBay Profit Analyzer",
                subtitle_app: "Calculate your eBay profitability and key metrics.",
                h2_primary_inputs: "Primary Financial Inputs",
                label_selling_price: "Selling Price ($)",
                label_cogs: "Cost of Goods Sold (COGS) ($)",
                summary_details: "Detailed Fees, Shipping, & Target",
                label_target_profit: "Target Net Profit ($)",
                label_ebay_fee_rate: "Total eBay Fee Rate (FVF + Payment Processing) (%)",
                label_shipping_cost: "Outbound Shipping Cost Paid by Seller ($)",
                label_promoted_rate: "Promoted Listing Rate (Ad Spend) (%)",
                label_prep_costs: "Prep & Labeling Costs ($)",
                label_misc_costs: "Miscellaneous Per-Unit Costs ($)",
                label_units_sold: "Estimated Monthly Units Sold",
                h2_results: "Results Overview",
                box_net_profit: "Net Profit / Unit",
                box_profit_margin: "Profit Margin",
                box_roi: "ROI",
                box_monthly_profit_pre: "Monthly Profit (Based on",
                box_monthly_profit_post: "Units)",
                h2_breakdown: "Unit Cost Breakdown",
                breakdown_ebay_fee: "Total eBay Fee (FVF + Payment):",
                breakdown_promoted_fee: "Promoted Listing Fee:",
                breakdown_shipping_cost: "Outbound Shipping Cost:",
                breakdown_prep_misc: "Prep & Other Costs:",
                breakdown_total_fees: "TOTAL SELLING FEES & COSTS:",
                breakdown_cogs: "COST OF GOODS SOLD (COGS):",
                breakdown_total_investment: "TOTAL INVESTMENT (PRICE FLOOR):",
                calc_min_price_pre: "Min Price for",
                calc_min_price_post: "Profit:",
                calc_max_cogs_pre: "Max COGS for",
                calc_max_cogs_post: "Profit:",
                lang_en: "English",
                lang_de: "German",
                currency_symbol: "$",
            },
            de: {
                title_app: "eBay Gewinnrechner",
                subtitle_app: "Berechne deine eBay-Rentabilität und Kennzahlen.",
                h2_primary_inputs: "Primäre finanzielle Eingaben",
                label_selling_price: "Verkaufspreis (€)",
                label_cogs: "Kosten der verkauften Waren (COGS) (€)",
                summary_details: "Detaillierte Gebühren, Versand & Zielvorgabe",
                label_target_profit: "Ziel-Nettogewinn (€)",
                label_ebay_fee_rate: "Gesamt-eBay-Gebührensatz (FVF + Zahlungsabwicklung) (%)",
                label_shipping_cost: "Versandkosten, bezahlt vom Verkäufer (€)",
                label_promoted_rate: "Promoted Listing Rate (Werbeausgaben) (%)",
                label_prep_costs: "Vorbereitungs- & Etikettierungskosten (€)",
                label_misc_costs: "Verschiedene Stückkosten (€)",
                label_units_sold: "Geschätzte monatliche Verkaufseinheiten",
                h2_results: "Ergebnisse im Überblick",
                box_net_profit: "Nettogewinn / Einheit",
                box_profit_margin: "Gewinnmarge",
                box_roi: "ROI",
                box_monthly_profit_pre: "Monatlicher Gewinn (Basierend auf",
                box_monthly_profit_post: "Einheiten)",
                h2_breakdown: "Stückkosten-Aufschlüsselung",
                breakdown_ebay_fee: "Gesamt-eBay-Gebühr (FVF + Zahlung):",
                breakdown_promoted_fee: "Promoted Listing Gebühr:",
                breakdown_shipping_cost: "Versandkosten:",
                breakdown_prep_misc: "Vorbereitungs- & Sonstige Kosten:",
                breakdown_total_fees: "GESAMTKOSTEN VERKAUF & GEBÜHREN:",
                breakdown_cogs: "KOSTEN DER VERKAUFTEN WAREN (COGS):",
                breakdown_total_investment: "GESAMTINVESTITION (PREISUNTERGRENZE):",
                calc_min_price_pre: "Mindestpreis für",
                calc_min_price_post: "Gewinn:",
                calc_max_cogs_pre: "Max. COGS für",
                calc_max_cogs_post: "Gewinn:",
                lang_en: "Englisch",
                lang_de: "Deutsch",
                currency_symbol: "€",
            }
        };

        // Default language (used if nothing is saved in localStorage)
        let currentLang = 'en';

        /**
         * Saves all relevant input values to the browser's local storage.
         */
        function saveSettings() {
            const inputs = [
                'sellingPrice', 'cogs', 'targetProfit', 'ebayFeeRate',
                'outboundShippingCost', 'promotedListingRate', 'prepCosts',
                'miscellaneousCosts', 'unitsSold'
            ];

            inputs.forEach(id => {
                const value = document.getElementById(id).value;
                localStorage.setItem(`ebayCalc_${id}`, value);
            });
        }

        /**
         * Loads all saved input values and the language from local storage,
         * updating the input fields and the currentLang variable.
         */
        function loadSettings() {
            const inputs = [
                'sellingPrice', 'cogs', 'targetProfit', 'ebayFeeRate',
                'outboundShippingCost', 'promotedListingRate', 'prepCosts',
                'miscellaneousCosts', 'unitsSold'
            ];

            inputs.forEach(id => {
                const savedValue = localStorage.getItem(`ebayCalc_${id}`);
                if (savedValue !== null) {
                    document.getElementById(id).value = savedValue;
                }
            });

            // Load saved language
            const savedLang = localStorage.getItem('ebayCalc_language');
            if (savedLang) {
                document.getElementById('languageSelector').value = savedLang;
                currentLang = savedLang;
            }
        }

        /**
         * Updates the UI text based on the selected language and saves the setting.
         * @param {string} lang - 'en' or 'de'.
         */
        function setLanguage(lang) {
            currentLang = lang;
            const langData = translations[lang];

            // 1. SAVE LANGUAGE TO LOCAL STORAGE
            localStorage.setItem('ebayCalc_language', lang);

            // 2. Update all elements with data-i18n attribute
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (langData[key]) {
                    element.textContent = langData[key];
                }
            });

            // 3. Set the document title
            document.title = langData['title_app'];

            // 4. Ensure the correct option in the selector is selected
            document.getElementById('languageSelector').value = lang;

            // 5. Update the input label currency symbols (if applicable)
            document.querySelector('[data-i18n="label_selling_price"]').textContent = langData['label_selling_price'];
            document.querySelector('[data-i18n="label_cogs"]').textContent = langData['label_cogs'];
            document.querySelector('[data-i18n="label_target_profit"]').textContent = langData['label_target_profit'];
            document.querySelector('[data-i18n="label_shipping_cost"]').textContent = langData['label_shipping_cost'];
            document.querySelector('[data-i18n="label_prep_costs"]').textContent = langData['label_prep_costs'];
            document.querySelector('[data-i18n="label_misc_costs"]').textContent = langData['label_misc_costs'];

            // 6. Re-run profit calculation to update currency displays (but don't save settings, they were already loaded/set)
            updateProfit(false);
        }

        /**
         * Returns the correct currency symbol for the current language.
         */
        function getCurrencySymbol() {
            return translations[currentLang]?.currency_symbol || '$';
        }

        /**
         * Formats a number into a currency string (e.g., $X.XX or €X.XX)
         * @param {number} value - The number to format.
         * @returns {string} - The formatted currency string.
         */
        function formatCurrency(value) {
            const symbol = getCurrencySymbol();
            return `${symbol}${Math.max(0, value).toFixed(2)}`;
        }

        /**
         * Formats a number into a percentage string (X.X%)
         * @param {number} value - The number to format.
         * @returns {string} - The formatted percentage string.
         */
        function formatPercentage(value) {
            return `${value.toFixed(1)}%`;
        }

        /**
         * Main function to read inputs, perform calculations, and update the UI.
         * @param {boolean} shouldSave - Flag to control if settings should be saved after update. Defaults to true for user input.
         */
        function updateProfit(shouldSave = true) {
            // --- 1. Get Input Values and Sanitize ---
            const sellingPrice = parseFloat(document.getElementById('sellingPrice').value) || 0;
            const cogs = parseFloat(document.getElementById('cogs').value) || 0;

            // eBay Specific Fees
            const ebayFeeRate = parseFloat(document.getElementById('ebayFeeRate').value) / 100 || 0;
            const promotedListingRate = parseFloat(document.getElementById('promotedListingRate').value) / 100 || 0;
            const outboundShippingCost = parseFloat(document.getElementById('outboundShippingCost').value) || 0;

            // Other Fixed Costs
            const prepCosts = parseFloat(document.getElementById('prepCosts').value) || 0;
            const miscellaneousCosts = parseFloat(document.getElementById('miscellaneousCosts').value) || 0;

            const unitsSold = parseInt(document.getElementById('unitsSold').value) || 0;
            const targetProfit = parseFloat(document.getElementById('targetProfit').value) || 0;

            // --- 2. Calculate Fees (Per Unit) ---

            // eBay Fee (FVF + Managed Payments)
            const ebayFee = sellingPrice * ebayFeeRate;

            // Promoted Listing Fee
            const promotedFee = sellingPrice * promotedListingRate;

            // Sum of all 'Other Fixed Costs'
            const totalOtherFixedCosts = prepCosts + miscellaneousCosts;

            // Total cost per unit (excluding COGS and profit) -> This is the TOTAL SELLING FEES & COSTS
            const totalFeesAndCostsPerUnit = ebayFee + promotedFee + outboundShippingCost + totalOtherFixedCosts;

            // Total investment per unit (COGS + all fees) -> This is the TOTAL INVESTMENT
            const totalInvestmentPerUnit = cogs + totalFeesAndCostsPerUnit;

            // --- 3. Calculate Profit Metrics (Per Unit) ---
            const netProfit = sellingPrice - totalInvestmentPerUnit;

            // Calculate Profit Margin: (Net Profit / Selling Price) * 100
            const profitMargin = (sellingPrice > 0) ? (netProfit / sellingPrice) * 100 : 0;

            // Calculate ROI: (Net Profit / Total Investment) * 100
            const roi = (totalInvestmentPerUnit > 0) ? (netProfit / totalInvestmentPerUnit) * 100 : 0;

            // --- 4. Calculate Total Monthly Profit ---
            const monthlyProfit = netProfit * unitsSold;

            // --- 5. Inverse Calculations for Key Metrics ---

            // 5a. Calculate MAX COGS: The highest COGS allowed to hit the target profit
            const maxCOGS = sellingPrice - totalFeesAndCostsPerUnit - targetProfit;

            // 5b. Calculate MIN Selling Price: The lowest Selling Price needed to hit the target profit

            // Fixed costs not dependent on price percentage (shipping, prep, cogs)
            const nonPercentageCosts = outboundShippingCost + totalOtherFixedCosts + cogs;

            let minSellingPrice = 0;
            // The formula is: S = (Target Profit + Fixed Costs) / (1 - Total Fee Rate)
            const totalFeeRate = ebayFeeRate + promotedListingRate;

            if (totalFeeRate < 1) {
                minSellingPrice = (targetProfit + nonPercentageCosts) / (1 - totalFeeRate);
            }

            // --- 6. Update UI with Results ---

            // Net Profit Box Styling
            const netProfitElement = document.getElementById('netProfit');
            netProfitElement.textContent = formatCurrency(netProfit);

            netProfitElement.classList.remove('bg-profit-green', 'bg-loss-red', 'text-ebay-dark', 'bg-yellow-400');
            if (netProfit >= targetProfit) {
                netProfitElement.classList.add('bg-profit-green', 'text-ebay-dark');
            } else if (netProfit >= 0) {
                netProfitElement.classList.add('bg-yellow-400', 'text-ebay-dark');
            } else {
                netProfitElement.classList.add('bg-loss-red', 'text-ebay-dark');
            }

            // Other Boxes
            document.getElementById('profitMargin').textContent = formatPercentage(profitMargin);
            document.getElementById('roi').textContent = formatPercentage(roi);

            // Update Monthly Profit Box
            document.getElementById('unitsSoldDisplay').textContent = unitsSold.toLocaleString();
            document.getElementById('monthlyProfit').textContent = formatCurrency(monthlyProfit);

            // --- 7. Update Unit Cost Breakdown Section ---
            document.getElementById('displayEbayFee').textContent = formatCurrency(ebayFee);
            document.getElementById('displayPromotedFee').textContent = formatCurrency(promotedFee);
            document.getElementById('displayShippingCost').textContent = formatCurrency(outboundShippingCost);

            // Other Fixed Costs Combined
            document.getElementById('displayOtherFixedCostsCombined').textContent = formatCurrency(totalOtherFixedCosts);

            // Total Selling Fees & Costs (eBay/Shipping/Prep)
            document.getElementById('displayTotalSellingFees').textContent = formatCurrency(totalFeesAndCostsPerUnit);

            // COGS Line
            document.getElementById('displayCOGS').textContent = formatCurrency(cogs);

            // Total Investment (Fees + COGS)
            document.getElementById('displayTotalInvestment').textContent = formatCurrency(totalInvestmentPerUnit);

            // --- 8. Update Labels with Inverse Metrics ---

            const minPriceValueContainer = document.getElementById('minPriceValue');
            const maxCogsValueContainer = document.getElementById('maxCogsValueContainer');

            const targetProfitText = formatCurrency(targetProfit);
            const langData = translations[currentLang];

            // Update Selling Price Label content (Min Price)
            const formattedMinPrice = formatCurrency(minSellingPrice);
            let minPriceColorClass = (sellingPrice >= minSellingPrice) ? 'text-profit-green' : 'text-loss-red';

            minPriceValueContainer.innerHTML = `
                (<span class="font-semibold ${minPriceColorClass}">${langData['calc_min_price_pre']} ${targetProfitText} ${langData['calc_min_price_post']} ${formattedMinPrice}</span>)
            `;


            // Update COGS Label content (Max COGS)
            const maxCogsValue = maxCOGS;
            const formattedMaxCOGS = formatCurrency(maxCogsValue);
            let maxCogsColorClass = (cogs <= maxCogsValue) ? 'text-profit-green' : 'text-loss-red';

            maxCogsValueContainer.innerHTML = `
                (<span class="font-semibold ${maxCogsColorClass}">${langData['calc_max_cogs_pre']} ${targetProfitText} ${langData['calc_max_cogs_post']} ${formattedMaxCOGS}</span>)
            `;

            // --- 9. Save Settings if triggered by user input ---
            if (shouldSave) {
                saveSettings();
            }
        }

        // Set up the initial listener on window load
        window.onload = function () {
            // 1. Load saved settings (values and language)
            loadSettings();

            // 2. Set language (which triggers the first updateProfit)
            // We use the language value determined by loadSettings() or the default 'en'
            setLanguage(currentLang);
        };
    </script>
</body>

</html>